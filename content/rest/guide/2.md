/*
Title: 2.理解数据
Sort: 2
Tmpl : page-guide
*/

## 2.理解数据

####JSON树

所有的数据都保存为JSON对象，没有表和记录的概念。当你把数据添加到这棵json 树中，这些数据就变成这棵树的子树。例如，我们在`users/mchen/`下添加一个子节点`widgets`，我们的数据结构如下：

```json

{

  "users": {

    "mchen": {

      "friends": { "brinchen": true },

      "name": "Mary Chen",

      // 我们新增加的子节点会出现在已有的JSON树上

      "widgets": { "one": true, "three": true }

    },

    "brinchen": { ... },

    "hmadi": { ... }

  }
}
```
####引用Wilddog的URL
通过REST API读取和写入数据时，我们在`curl`请求中包含指向Wilddog数据仓库的URL，这个URL会指向我们存储的所有数据。在这个示例中，我们将使用`https://docs-examples.wilddogio.com/rest/data`这个地址。
Wilddog还提供了一个面板，用来展示可视化的数据，并提供用于完成简单管理任务的工具。本指南所有的数据都存储在`docs-examples`这个APP中，通过`https://docs-examples.wilddogio.com/rest/data`可以看到只读的数据面板。
同样也可以直接访问子节点的数据，例如，要访问Mary Chen的name，只需要在URL之后追加`users/mchen/name`即可。
```
curl https://docs-examples.wilddogio.com/web/data/users/mchen/name
```
同样的方式，可以直接通过在URL之后追加子节点路径的方式得到数据。

####Wilddog中的数组
Wilddog对数组不提供原生支持，如果我们想存储数组，实际上存储的是以数字作为key的对象。
```
// 我们发送的数据

['hello', 'world']

// wilddog存储的数据

{0: 'hello', 1: 'world'}

//然而，为了帮助用户存储数组，当数据通过val()或者REST API读取时，如果数据看起来像数组，Wilddog就会把数据转换为数组。特别地，如果数据的key值都是整数，并且超过一半是在0到最大值之间并且没有空值，那么Wilddog会将其转换为数组。这一部分要引起注意：

// 我们发送的数据

['a', 'b', 'c', 'd', 'e']

// wilddog保存的数据

{0: 'a', 1: 'b', 2: 'c', 3: 'd', 4: 'e'}

// 由于key是数字型，且是有序的

// 如果我们查询数据，会得到以下形式

['a', 'b', 'c', 'd', 'e']

// 但是，如果我们删除a、b、d

// 他们不再是有序的

// 我们不会再得到数组形式

{2: 'c', 4: 'e'}

```
当前没有办法改变或者阻止这种行为，理解这一点可以知道存储类似数组数据时什么能做什么不能做。
为什么不提供对数组的全支持呢？这是因为数组的索引不是永久的，不是id唯一的，并发编辑时是容易出问题的。
例如，假设两个用户通过远程服务器同时更新一个数组，用户A想要改变key为2的数值，用户B想要移动并改变它，那结果会出现错误。
下面是其中的一种情况：
```
// 初始数据

['a', 'b', 'c', 'd', 'e']

// 用户A将key为2的记录移动到位置5

// 用户B要删除key为2的记录

// 用户C将key为2的记录更新为foo

// 最理想的是以下的情况

['a', 'b', 'd', 'e']

// 实际发生的是以下的情况

['a', 'c', 'foo', 'b']

```
那什么时候可以使用数组呢？如果满足以下条件，可以在Wilddog中存储数组：
* 每次保证只有一个客户端写数据
* 要删除元素的时候，我们重新保存整个数组，而不是调用`.remove()`方法
* 特别注意根据数组索引更新内容的情况

####限制和约束
快速预览在进行数据存储、数据读取操作时的一些限制

 描述   |    限制    |    注意事项
---- 		| ---- 		| ----
树的深度	|	32	|
key长度		|	768 bytes	|	UTF-8编码,不能包含 . $ [ ] / 和ASCII控制字符
一个叶子节点的数据大小	|	10mb		|	UTF-8编码
通过SDK写入的数据大小限制	|		16mb	|		UTF-8编码
通过 REST 写入数据大小限制		|	256mb	| 				
一次能读取的节点	|    1亿	|
